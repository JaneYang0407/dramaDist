import{bP as U,r as $,a7 as q,bO as H,c as O,ag as K,bN as W,w as Y,y as f,z as v,A as t,P as p,I as w,aD as V,N as n,H as E,K as k,D as N,u as D,O as G,an as J,M as C}from"./vue-mr2w3f1M.js";import{s as Q}from"./pinia--8Gmfku1.js";import{u as X}from"./apiConfig-Dx1zKg0v.js";import{a as c,g as d}from"./index-De3j1VZw.js";import{L as Z}from"./page-dKwHItdI.js";import{a as I,E as S}from"./element-plus-BOnWL2JY.js";import"./vendor-ByJfu4Fc.js";import"./swiper-2AkFM_2d.js";import"./axios-DW_MHI2K.js";const ee={class:"MainBox"},ae={class:"MainInner"},te={class:"MemberBox"},se={class:"MemberMenu"},oe={class:"MemberMenuListBox"},ie={class:"MemberMenuList"},le={class:"MemberMenuList"},re={class:"MemberMenuList"},ne={class:"MemberCont"},ce={class:"MemberTopic Topic1"},ue={class:"MemberReal"},de={key:0,class:""},ve={class:"TabBtnBox mb-10"},me={key:0,class:"DramaListBox"},_e={key:0,class:"DramaListPic"},ge=["src"],he={class:"DramaListInfo"},fe={class:"DramaListTop"},pe={class:"DramaListTag"},ye=["onClick"],be={class:""},$e={class:"DramaListRate"},we={class:"DramaListRateNum"},De={class:"DramaListDes"},Le={class:"DramaListBot"},Me={class:"DetailBannerMix"},Be={class:"DetailBannerMixTit"},ke={class:"DetailBannerRateBtn"},Ce={class:"text"},Se={class:"DetailBannerRateScore"},je={__name:"[type]",setup(Re){const{locale:y,t:_}=U(),u=H(),R=W(),m=$(!0),P=X();P.getApiConfig();const{apiConfig:A}=Q(P),e=q([]),g=$(1),b=$(0),h=$(u.params.type),L=O(()=>{if(h.value==="movie")return"movies";if(h.value==="show")return"tv"}),T=O(()=>{if(h.value==="movie")return"movie";if(h.value==="show")return"tv"}),M=async()=>{try{m.value=!0;const o=await c.get(`/account/${d("account_id")}/favorite/${L.value}`,{params:{language:y.value,page:g.value,sort_by:"created_at.desc"}});Object.assign(e,o.results),b.value=o.total_results;for(let i=0;i<e.length;i++)u.params.type==="movie"?e[i].category="movie":u.params.type==="show"&&(e[i].category="show");await(async i=>{const a=await Promise.all(i.map(async s=>{const r=await c.get(`/${s.category==="movie"?"movie":"tv"}/${s.id}/account_states`,{params:{session_id:d("session_id")}});return{...s,detail:r}}));e.splice(0,e.length,...a)})(e);for(let i=0;i<e.length;i++)e[i].detail.rated!==!1?e[i].detail.ratedScore=e[i].detail.rated.value:e[i].detail.ratedScore=0}catch(o){console.error("Error fetching data:",o)}finally{m.value=!1}};K(async()=>{u.params.type!=="movie"&&u.params.type!=="show"&&await R.push({path:"/member/favorite/movie"}),M()}),Y(y,()=>{M()});async function x(o){m.value=!0,e.length=0,g.value=1,h.value=o,await R.push({path:`/member/favorite/${o}`});const l=await c.get(`/account/${d("account_id")}/favorite/${L.value}`,{params:{language:y.value,page:g.value,sort_by:"created_at.desc"}});Object.assign(e,l.results),b.value=l.total_results;for(let a=0;a<e.length;a++)e[a].category=h.value;await(async a=>{const s=await Promise.all(a.map(async r=>{const B=await c.get(`/${r.category==="movie"?"movie":"tv"}/${r.id}/account_states`,{params:{session_id:d("session_id")}});return{...r,detail:B}}));e.splice(0,e.length,...s)})(e);for(let a=0;a<e.length;a++)e[a].detail.rated!==!1?e[a].detail.ratedScore=e[a].detail.rated.value:e[a].detail.ratedScore=0;m.value=!1}async function F(o){m.value=!0,e.length=0,g.value=o;const l=await c.get(`/account/${d("account_id")}/favorite/${L.value}`,{params:{language:y.value,page:g.value,sort_by:"created_at.desc"}});Object.assign(e,l.results),b.value=l.total_results;for(let a=0;a<e.length;a++)u.params.type==="movie"?e[a].category="movie":u.params.type==="show"&&(e[a].category="show");await(async a=>{const s=await Promise.all(a.map(async r=>{const B=await c.get(`/${r.category==="movie"?"movie":"tv"}/${r.id}/account_states`,{params:{session_id:d("session_id")}});return{...r,detail:B}}));e.splice(0,e.length,...s)})(e);for(let a=0;a<e.length;a++)e[a].detail.rated!==!1?e[a].detail.ratedScore=e[a].detail.rated.value:e[a].detail.ratedScore=0;m.value=!1}function j(o){c.post(`/account/${d("account_id")}/favorite`,{media_type:T.value,media_id:o,favorite:!1}).then(async l=>{l.success&&(await c.get(`/${T.value}/${o}/account_states`),S.alert(_("global.removeFavoriteSuccess"),"",{center:!0,confirmButtonText:_("global.confirm")}),M())})}function z(o,l,i){i===0?c.delete(`/${l==="movie"?"movie":"tv"}/${o}/rating`,{session_id:d("session_id")}).then(async a=>{S.alert(_("global.resetRateSuccess"),"",{center:!0,confirmButtonText:_("global.confirm")})}):c.post(`/${l==="movie"?"movie":"tv"}/${o}/rating`,{session_id:d("session_id"),value:i}).then(async a=>{S.alert(_("global.rateSuccess"),"",{center:!0,confirmButtonText:_("global.confirm")})})}return(o,l)=>{const i=V("RouterLink"),a=V("ElPagination");return v(),f("div",ee,[t("div",ae,[t("div",te,[t("nav",se,[t("ul",oe,[t("li",ie,[p(i,{to:"/member",class:"MemberMenuListLink"},{default:w(()=>[C(n(o.$t("global.member")),1)]),_:1})]),t("li",le,[p(i,{to:"/member/favorite/movie",class:"MemberMenuListLink active"},{default:w(()=>[C(n(o.$t("global.myFavorite")),1)]),_:1})]),t("li",re,[p(i,{to:"/member/watchlist/movie",class:"MemberMenuListLink"},{default:w(()=>[C(n(o.$t("global.myWatchList")),1)]),_:1})])])]),t("div",ne,[t("h1",ce,n(o.$t("global.myFavorite")),1),t("div",ue,[m.value?(v(),E(Z,{key:1,class:"noBg"})):(v(),f("div",de,[t("div",ve,[t("div",{class:N(["TabBtn",{active:D(u).fullPath.indexOf("movie")>-1}]),onClick:l[0]||(l[0]=s=>x("movie"))},n(o.$t("global.movie")),3),t("div",{class:N(["TabBtn",{active:D(u).fullPath.indexOf("show")>-1}]),onClick:l[1]||(l[1]=s=>x("show"))},n(o.$t("global.show")),3)]),e.length>0?(v(),f("ul",me,[(v(!0),f(G,null,J(e,s=>(v(),f("li",{key:s.id,class:"DramaList"},[s.poster_path!==""?(v(),f("div",_e,[t("img",{src:`${D(A).images.secure_base_url}w154${s.poster_path}`,loading:"lazy",alt:""},null,8,ge)])):k("",!0),t("div",he,[t("div",fe,[t("div",pe,n(s.release_date??s.first_air_date),1),t("div",{class:"DramaListAct",onClick:r=>j(s.id)},l[2]||(l[2]=[t("i",{class:"icon icon-heartFill"},null,-1)]),8,ye)]),p(i,{to:`/${s.category}/${s.id}`,class:"DramaListTitle"},{default:w(()=>[t("h2",be,n(s.title??s.name),1)]),_:2},1032,["to"]),t("div",$e,[l[3]||(l[3]=t("i",{class:"icon icon-starFill"},null,-1)),t("div",we,n(s.vote_average),1)]),t("p",De,n(s.overview),1),t("div",Le,[t("div",Me,[t("div",Be,[t("div",ke,[t("div",Ce,n(o.$t("global.myRate"))+":",1)]),t("div",Se,n(s.detail.ratedScore>0?s.detail.ratedScore:o.$t("global.notRateYet")),1)]),p(D(I),{modelValue:s.detail.ratedScore,"onUpdate:modelValue":r=>s.detail.ratedScore=r,max:10,clearable:"",onChange:r=>z(s.id,s.category,s.detail.ratedScore)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])])]))),128))])):k("",!0),e.length>0?(v(),E(a,{key:1,layout:"prev, pager, next","current-page":g.value,total:b.value,"pager-count":5,"default-page-size":20,onCurrentChange:F},null,8,["current-page","total"])):k("",!0)]))])])])])])}}};export{je as default};
