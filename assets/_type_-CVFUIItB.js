import{bP as V,r as f,a7 as S,bO as W,c as O,ag as q,bN as H,w as K,y as h,z as u,A as t,P as b,I as w,aD as N,N as c,H as E,K as D,D as A,u as k,O as G,an as J,M as B}from"./vue-mr2w3f1M.js";import{s as Q}from"./pinia--8Gmfku1.js";import{u as U}from"./apiConfig-Dx1zKg0v.js";import{a as m,g as d}from"./index-De3j1VZw.js";import{L as X}from"./page-dKwHItdI.js";import{E as Y}from"./element-plus-BOnWL2JY.js";import"./vendor-ByJfu4Fc.js";import"./swiper-2AkFM_2d.js";import"./axios-DW_MHI2K.js";const Z={class:"MainBox"},I={class:"MainInner"},ee={class:"MemberBox"},te={class:"MemberMenu"},ae={class:"MemberMenuListBox"},se={class:"MemberMenuList"},oe={class:"MemberMenuList"},ie={class:"MemberMenuList"},le={class:"MemberCont"},ne={class:"MemberTopic Topic1"},ce={class:"MemberReal"},re={key:0,class:""},ue={class:"TabBtnBox mb-10"},me={key:0,class:"DramaListBox"},ve={key:0,class:"DramaListPic"},de=["src"],_e={class:"DramaListInfo"},ge={class:"DramaListTop"},he={class:"DramaListTag"},pe=["onClick"],ye={class:""},fe={class:"DramaListRate"},be={class:"DramaListRateNum"},we={class:"DramaListDes"},xe={__name:"[type]",setup($e){const{locale:p,t:C}=V(),r=W(),P=H(),v=f(!0),T=U();T.getApiConfig();const{apiConfig:j}=Q(T),e=S([]),_=f(1),y=f(0),g=f(r.params.type),$=O(()=>{if(g.value==="movie")return"movies";if(g.value==="show")return"tv"}),R=O(()=>{if(g.value==="movie")return"movie";if(g.value==="show")return"tv"}),L=async()=>{try{v.value=!0;const s=await m.get(`/account/${d("account_id")}/watchlist/${$.value}`,{params:{language:p.value,page:_.value,sort_by:"created_at.desc"}});Object.assign(e,s.results),y.value=s.total_results;for(let l=0;l<e.length;l++)r.params.type==="movie"?e[l].category="movie":r.params.type==="show"&&(e[l].category="show");await(async l=>{const i=await Promise.all(l.map(async a=>{const n=await m.get(`/${a.category==="movie"?"movie":"tv"}/${a.id}/account_states`,{params:{session_id:d("session_id")}});return{...a,detail:n}}));e.splice(0,e.length,...i)})(e)}catch(s){console.error("Error fetching data:",s)}finally{v.value=!1}};q(async()=>{r.params.type!=="movie"&&r.params.type!=="show"&&await P.push({path:"/member/watchlist/movie"}),L()}),K(p,()=>{L()});async function x(s){v.value=!0,e.length=0,_.value=1,g.value=s,await P.push({path:`/member/watchlist/${s}`});const o=await m.get(`/account/${d("account_id")}/watchlist/${$.value}`,{params:{language:p.value,page:_.value,sort_by:"created_at.desc"}});Object.assign(e,o.results),y.value=o.total_results;for(let i=0;i<e.length;i++)e[i].category=g.value;await(async i=>{const a=await Promise.all(i.map(async n=>{const M=await m.get(`/${n.category==="movie"?"movie":"tv"}/${n.id}/account_states`,{params:{session_id:d("session_id")}});return{...n,detail:M}}));e.splice(0,e.length,...a)})(e),v.value=!1}async function z(s){v.value=!0,e.length=0,_.value=s;const o=await m.get(`/account/${d("account_id")}/watchlist/${$.value}`,{params:{language:p.value,page:_.value,sort_by:"created_at.desc"}});Object.assign(e,o.results),y.value=o.total_results;for(let i=0;i<e.length;i++)r.params.type==="movie"?e[i].category="movie":r.params.type==="show"&&(e[i].category="show");await(async i=>{const a=await Promise.all(i.map(async n=>{const M=await m.get(`/${n.category==="movie"?"movie":"tv"}/${n.id}/account_states`,{params:{session_id:d("session_id")}});return{...n,detail:M}}));e.splice(0,e.length,...a)})(e),v.value=!1}function F(s){m.post(`/account/${d("account_id")}/watchlist`,{media_type:R.value,media_id:s,watchlist:!1}).then(async o=>{o.success&&(await m.get(`/${R.value}/${s}/account_states`),Y.alert(C("global.removeWatchlistSuccess"),"",{center:!0,confirmButtonText:C("global.confirm")}),L())})}return(s,o)=>{const l=N("RouterLink"),i=N("ElPagination");return u(),h("div",Z,[t("div",I,[t("div",ee,[t("nav",te,[t("ul",ae,[t("li",se,[b(l,{to:"/member",class:"MemberMenuListLink"},{default:w(()=>[B(c(s.$t("global.member")),1)]),_:1})]),t("li",oe,[b(l,{to:"/member/favorite/movie",class:"MemberMenuListLink"},{default:w(()=>[B(c(s.$t("global.myFavorite")),1)]),_:1})]),t("li",ie,[b(l,{to:"/member/watchlist/movie",class:"MemberMenuListLink active"},{default:w(()=>[B(c(s.$t("global.myWatchList")),1)]),_:1})])])]),t("div",le,[t("h1",ne,c(s.$t("global.myWatchList")),1),t("div",ce,[v.value?(u(),E(X,{key:1,class:"noBg"})):(u(),h("div",re,[t("div",ue,[t("div",{class:A(["TabBtn",{active:k(r).fullPath.indexOf("movie")>-1}]),onClick:o[0]||(o[0]=a=>x("movie"))},c(s.$t("global.movie")),3),t("div",{class:A(["TabBtn",{active:k(r).fullPath.indexOf("show")>-1}]),onClick:o[1]||(o[1]=a=>x("show"))},c(s.$t("global.show")),3)]),e.length>0?(u(),h("ul",me,[(u(!0),h(G,null,J(e,a=>(u(),h("li",{key:a.id,class:"DramaList"},[a.poster_path!==""?(u(),h("div",ve,[t("img",{src:`${k(j).images.secure_base_url}w154${a.poster_path}`,loading:"lazy",alt:""},null,8,de)])):D("",!0),t("div",_e,[t("div",ge,[t("div",he,c(a.release_date??a.first_air_date),1),t("div",{class:"DramaListAct",onClick:n=>F(a.id)},o[2]||(o[2]=[t("i",{class:"icon icon-listFill"},null,-1)]),8,pe)]),b(l,{to:`/${a.category}/${a.id}`,class:"DramaListTitle"},{default:w(()=>[t("h2",ye,c(a.title??a.name),1)]),_:2},1032,["to"]),t("div",fe,[o[3]||(o[3]=t("i",{class:"icon icon-starFill"},null,-1)),t("div",be,c(a.vote_average),1)]),t("p",we,c(a.overview),1)])]))),128))])):D("",!0),e.length>0?(u(),E(i,{key:1,layout:"prev, pager, next","current-page":_.value,total:y.value,"pager-count":5,"default-page-size":20,onCurrentChange:z},null,8,["current-page","total"])):D("",!0)]))])])])])])}}};export{xe as default};
